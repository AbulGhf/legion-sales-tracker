<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Legion Sale Tracker</title>
    <!-- Load React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <!-- Load Tailwind -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <!-- Load Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Basic styles */
        body {
            background-color: #0f0f0f;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Session neon teal color */
        .neon-color {
            color: #24f2d2;
        }
        
        /* Main container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header card */
        .header-card {
            background: linear-gradient(90deg, #18a692 0%, #24f2d2 100%);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border: 1px solid rgba(36, 242, 210, 0.15);
        }
        
        .header-title {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }
        
        /* Cards */
        .card {
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(36, 242, 210, 0.15);
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .card-subtitle {
            font-size: 0.9rem;
            color: #b0b0b0;
        }
        
        /* Amount display */
        .amount-display {
            font-size: 2rem;
            font-weight: bold;
            color: #24f2d2;
            margin: 10px 0;
        }
        
        /* Stats section */
        .stats-section {
            margin-top: 20px;
        }
        
        .stats-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-card {
            background-color: #121827;
            border-left: 4px solid #24f2d2;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #b0b0b0;
        }
        
        .stats-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #24f2d2;
        }
        
        /* Table */
        .table-container {
            width: 100%;
            overflow-x: auto;
            border-radius: 8px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table-header {
            background-color: rgba(36, 242, 210, 0.8);
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .table-header th {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(36, 242, 210, 0.1);
            color: #0f1723;
        }
        
        .table-header th:first-child {
            border-top-left-radius: 8px;
        }
        
        .table-header th:last-child {
            border-top-right-radius: 8px;
        }
        
        .table-row td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(36, 242, 210, 0.05);
        }
        
        .table-row:nth-child(odd) {
            background-color: rgba(30, 30, 30, 0.6);
        }
        
        .table-row:nth-child(even) {
            background-color: rgba(40, 40, 40, 0.6);
        }
        
        .table-row:hover {
            background-color: rgba(36, 242, 210, 0.2);
        }
        
        /* Rank badge */
        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: #24f2d2;
            color: #0f1723;
            font-weight: bold;
            border-radius: 50%;
        }
        
        /* Address */
        .address-cell {
            font-family: monospace;
            color: #fff;
        }
        
        .address-cell a {
            color: #fff;
            text-decoration: none;
        }
        
        .address-cell a:hover {
            text-decoration: underline;
            color: #24f2d2;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            gap: 10px;
        }
        
        .pagination-button {
            background-color: #24f2d2;
            color: #0f1723;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pagination-button:hover {
            background-color: #4fffe2;
        }
        
        .pagination-button:disabled {
            background-color: #18a692;
            color: #d4fff5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            background-color: rgba(36, 242, 210, 0.1);
            padding: 8px 12px;
            border-radius: 4px;
            color: #24f2d2;
        }
        
        /* Note box */
        .note-box {
            background-color: rgba(36, 242, 210, 0.1);
            border-left: 3px solid #24f2d2;
            padding: 12px 16px;
            margin: 12px 0;
            font-size: 0.9rem;
        }
        
        /* Back button */
        .back-button {
            display: inline-flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            transition: background-color 0.2s;
        }
        
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Live Feed Styling */
        .live-feed-card {
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(36, 242, 210, 0.15);
            display: flex;
            flex-direction: column;
        }
        
        .live-feed-header {
            padding: 15px;
            border-bottom: 1px solid rgba(36, 242, 210, 0.15);
        }
        
        .live-feed {
            max-height: 320px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #24f2d2 #1a1a1a;
        }
        
        .live-feed::-webkit-scrollbar {
            width: 6px;
        }
        
        .live-feed::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 3px;
        }
        
        .live-feed::-webkit-scrollbar-thumb {
            background-color: #24f2d2;
            border-radius: 3px;
        }
        
        .feed-item {
            background: rgba(40, 40, 40, 0.6);
            margin: 4px;
            border-radius: 4px;
            padding: 10px 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .feed-item:hover {
            background: rgba(50, 50, 50, 0.8);
        }
        
        .feed-logo {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 12px;
        }
        
        .feed-address {
            color: #b0b0b0;
            font-family: monospace;
            text-decoration: none;
            transition: color 0.2s ease;
            flex: 1;
        }
        
        .feed-address:hover {
            color: #ffffff;
            text-decoration: underline;
        }
        
        .feed-amount {
            font-weight: 700;
            margin-left: auto;
            margin-right: 10px;
            font-family: monospace;
            color: #24f2d2;
        }
        
        .feed-time {
            color: #777;
            font-size: 0.75rem;
            width: 60px;
            text-align: right;
        }
        
        /* Investor Modal Styles */
        .investor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .investor-modal-content {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 2rem;
            position: relative;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(36, 242, 210, 0.15);
        }

        .investor-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

        .investor-modal-close:hover {
            color: #24f2d2;
        }

        .investor-details h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #24f2d2;
        }

        .investor-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .investor-stat {
            background-color: #121827;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #24f2d2;
        }

        .investor-stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #24f2d2;
            margin-bottom: 0.5rem;
        }

        .investor-stat-label {
            color: #b0b0b0;
            font-size: 0.875rem;
        }

        /* Sales table in investor modal */
        .sales-table-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid rgba(36, 242, 210, 0.1);
            border-radius: 6px;
        }

        .session-sale {
            background-color: rgba(36, 242, 210, 0.1) !important;
        }

        /* Sale type badge */
        .sale-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .sale-badge.session {
            background-color: #24f2d2;
            color: #0f1723;
        }

        .sale-badge.other {
            background-color: #1d1d28;
            color: #fff;
        }

        /* Loading animation */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #24f2d2;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Root div where React will render -->
    <div id="app">Loading...</div>
    
    <!-- React app script -->
    <script type="text/babel">
        // Add UUID polyfill
        if (!crypto.randomUUID) {
            crypto.randomUUID = function() {
                return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                );
            };
        }

        // Define API base URL using environment variable or default to relative path
        var API_BASE_URL = typeof process !== 'undefined' && process.env && process.env.API_BASE_URL
            ? process.env.API_BASE_URL
            : '/'; // Default to relative path for production

        // Ensure trailing slash
        if (API_BASE_URL.charAt(API_BASE_URL.length - 1) !== '/') {
            API_BASE_URL += '/';
        }

        // For local development, override API_BASE_URL
        API_BASE_URL = 'http://192.168.100.2:5000/';

        // LiveFeed component
        function LiveFeed() {
            var transactionsState = React.useState([]);
            var transactions = transactionsState[0];
            var setTransactions = transactionsState[1];
            var loadingState = React.useState(true);
            var loading = loadingState[0];
            var setLoading = loadingState[1];
            var errorState = React.useState(null);
            var error = errorState[0];
            var setError = errorState[1];
            
            // Format address helper
            function formatAddress(address) {
                if (!address) return 'Unknown';
                return address.substring(0, 6) + '...' + address.substring(address.length - 4);
            }
            
            // Function to format time "time ago"
            function timeAgo(date) {
                var seconds = Math.floor((new Date() - new Date(date)) / 1000);
                
                if (seconds < 5) return 'just now';
                if (seconds < 60) return seconds + 's ago';
                
                var minutes = Math.floor(seconds / 60);
                if (minutes < 60) return minutes + 'm ago';
                
                var hours = Math.floor(minutes / 60);
                if (hours < 24) return hours + 'h ago';
                
                var days = Math.floor(hours / 24);
                return days + 'd ago';
            }
            
            // Function to fetch live transactions
            var fetchLiveTransactions = React.useCallback(function() {
                setLoading(true);
                fetch(API_BASE_URL + 'api/live-feed?sale=session&limit=8')
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Failed to fetch live transactions');
                        }
                        return response.json();
                    })
                    .then(function(data) {
                        setTransactions(data.transactions || []);
                        setLoading(false);
                    })
                    .catch(function(error) {
                        console.error('Error fetching live transactions:', error);
                        setError(error.message);
                        setLoading(false);
                    });
            }, []);
            
            // Update times every minute
            React.useEffect(function() {
                var timeUpdateInterval = setInterval(function() {
                    setTransactions(function(prevTransactions) { return prevTransactions.slice(); });
                }, 60000);
                
                return function() { clearInterval(timeUpdateInterval); };
            }, []);
            
            // Fetch transactions on component mount and set up polling
            React.useEffect(function() {
                fetchLiveTransactions();
                
                var interval = setInterval(fetchLiveTransactions, 30000);
                
                return function() { clearInterval(interval); };
            }, [fetchLiveTransactions]);
            
            return React.createElement('div', { className: 'live-feed-card' },
                React.createElement('div', { className: 'live-feed-header' },
                    React.createElement('div', { className: 'stats-title' },
                        React.createElement('span', null, 'Live Feed'),
                        React.createElement('i', { className: 'fas fa-bolt' })
                    )
                ),
                React.createElement('div', { className: 'live-feed' },
                    loading && transactions.length === 0 ?
                        React.createElement('div', { className: 'text-center text-gray-500 py-2' },
                            React.createElement('i', { className: 'fas fa-circle-notch fa-spin mr-2' }),
                            'Connecting to live feed...'
                        ) :
                    error ?
                        React.createElement('div', { className: 'text-center text-red-500 py-2' },
                            'Error loading live feed: ' + error
                        ) :
                    transactions.length === 0 ?
                        React.createElement('div', { className: 'text-center text-gray-500 py-2' },
                            'No recent transactions found.'
                        ) :
                        transactions.map(function(tx, index) {
                            return React.createElement('div', { className: 'feed-item', key: index },
                                React.createElement('img', { 
                                    src: '/static/session.png', 
                                    className: 'feed-logo', 
                                    alt: 'Session'
                                }),
                                React.createElement('a', {
                                    href: 'https://arbiscan.io/tx/' + tx.hash,
                                    target: '_blank',
                                    rel: 'noopener noreferrer',
                                    className: 'feed-address'
                                }, formatAddress(tx.from)),
                                React.createElement('span', { className: 'feed-amount' }, '+' + tx.amount.toFixed(2)),
                                React.createElement('span', { className: 'feed-time' }, timeAgo(tx.timestamp))
                            );
                        })
                )
            );
        }

        // Main app component
        function SessionTracker() {
            // State hooks
            var statsState = React.useState({
                total_investment: 0,
                total_investors: 0,
                average_allocation: 0,
                median_investment: 0,
                highest_allocation: 0,
                lowest_allocation: 0,
                transaction_count: 0
            });
            var stats = statsState[0];
            var setStats = statsState[1];
            var allInvestorsState = React.useState([]); // Store all investors
            var allInvestors = allInvestorsState[0];
            var setAllInvestors = allInvestorsState[1];
            var loadingState = React.useState(true);
            var loading = loadingState[0];
            var setLoading = loadingState[1];
            var errorState = React.useState(null);
            var error = errorState[0];
            var setError = errorState[1];
            var sortOrderState = React.useState('desc');
            var sortOrder = sortOrderState[0];
            var setSortOrder = sortOrderState[1];
            var currentPageState = React.useState(1);
            var currentPage = currentPageState[0];
            var setCurrentPage = currentPageState[1];
            var totalPagesState = React.useState(1);
            var totalPages = totalPagesState[0];
            var setTotalPages = totalPagesState[1];
            var selectedInvestorState = React.useState(null);
            var selectedInvestor = selectedInvestorState[0];
            var setSelectedInvestor = selectedInvestorState[1];
            var showModalState = React.useState(false);
            var showModal = showModalState[0];
            var setShowModal = showModalState[1];
            var investorLoadingState = React.useState(false);
            var investorLoading = investorLoadingState[0];
            var setInvestorLoading = investorLoadingState[1];
            
            // Constants
            var investorsPerPage = 10;
            
            // Format currency
            function formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount);
            }
            
            // Format address
            function formatAddress(address) {
                if (!address) return 'Unknown';
                return address.substring(0, 6) + '...' + address.substring(address.length - 4);
            }
            
            // Toggle sort order
            function toggleSortOrder() {
                setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc');
            }
            
            // Function to calculate median
            function calculateMedian(amounts) {
                if (amounts.length === 0) return 0;
                amounts.sort(function(a, b) { return a - b; });
                var mid = Math.floor(amounts.length / 2);
                if (amounts.length % 2 === 0) {
                    return (amounts[mid - 1] + amounts[mid]) / 2;
                } else {
                    return amounts[mid];
                }
            }
            
            // Fetch all investors
            function fetchAllInvestors() {
                return fetch(API_BASE_URL + 'api/session/investors') // Fetch all investors without pagination
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {
                        return data.investors || [];
                    });
            }
            
            // Fetch data
            function fetchData() {
                setLoading(true);
                // Helper function to safely parse JSON
                function safeJsonParse(response) {
                    return response.text().then(function(text) {
                        if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                            throw new Error('Server returned HTML instead of JSON');
                        }
                        return JSON.parse(text);
                    }).catch(function(e) {
                        console.error('JSON parse error:', e);
                        throw new Error('Invalid JSON response from server');
                    });
                }

                // Fetch stats
                fetch(API_BASE_URL + 'api/session/stats')
                    .then(function(response) {
                        return safeJsonParse(response);
                    })
                    .then(function(statsData) {
                        // Fetch all investors to calculate median and for pagination
                        return fetchAllInvestors().then(function(investorsData) {
                            var amounts = investorsData.map(function(investor) { return investor.amount || 0; });
                            var median = calculateMedian(amounts);
                            
                            setStats({
                                total_investment: statsData.total_investment || 0,
                                total_investors: statsData.total_investors || 0,
                                average_allocation: statsData.average_allocation || 0,
                                median_investment: median,
                                highest_allocation: statsData.highest_allocation ? statsData.highest_allocation.amount : 0,
                                lowest_allocation: statsData.lowest_allocation ? statsData.lowest_allocation.amount : 0,
                                transaction_count: 0 // API does not provide this
                            });
                            
                            // Store all investors
                            setAllInvestors(investorsData);
                            
                            // Calculate total pages for client-side pagination
                            var totalInvestors = statsData.total_investors || investorsData.length;
                            setTotalPages(Math.ceil(totalInvestors / investorsPerPage));
                            
                            setLoading(false);
                        });
                    })
                    .catch(function(error) {
                        console.error('Error fetching data:', error);
                        setError(error.message || "Failed to load data");
                        setLoading(false);
                    });
            }
            
            // Handle investor click to show modal
            function handleInvestorClick(address) {
                setInvestorLoading(true);
                setShowModal(true);
                setSelectedInvestor(null);
                
                fetch(API_BASE_URL + 'api/investor/' + address)
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Failed to fetch investor details');
                        }
                        return response.text();
                    })
                    .then(function(text) {
                        if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                            throw new Error('Server returned HTML instead of JSON');
                        }
                        var data = JSON.parse(text);
                        
                        if (data.error) {
                            throw new Error(data.error);
                        }

                        var allSales = data.sales || [];
                        var sessionSales = allSales.filter(function(sale) { return sale.sale && sale.sale.toLowerCase() === 'session'; });
                        var sessionTotal = sessionSales.reduce(function(sum, sale) { return sum + (sale.amount || 0); }, 0);

                        setSelectedInvestor({
                            address: address,
                            total_invested: allSales.reduce(function(sum, sale) { return sum + (sale.amount || 0); }, 0),
                            session_total: sessionTotal,
                            sales_participated: allSales.length,
                            session_sales: sessionSales.length,
                            sales: allSales
                        });
                        setInvestorLoading(false);
                    })
                    .catch(function(error) {
                        console.error('Error fetching investor details:', error);
                        setSelectedInvestor({
                            address: address || 'Unknown',
                            total_invested: 0,
                            session_total: 0,
                            sales_participated: 0,
                            session_sales: 0,
                            sales: []
                        });
                        setInvestorLoading(false);
                    });
            }
            
            // Close modal
            function closeModal() {
                setShowModal(false);
                setSelectedInvestor(null);
            }
            
            // Handle page change
            function handlePageChange(newPage) {
                setCurrentPage(newPage);
            }
            
            // Fetch data on load (no dependency on currentPage since we're doing client-side pagination)
            React.useEffect(function() {
                fetchData();
            }, []);
            
            // Calculate the investors to display based on the current page (client-side pagination)
            var startIndex = (currentPage - 1) * investorsPerPage;
            var endIndex = startIndex + investorsPerPage;
            var investorsForPage = allInvestors.slice(startIndex, endIndex);
            
            // Sort investors based on current sort order
            var sortedInvestors = React.useMemo(function() {
                return investorsForPage.slice().sort(function(a, b) {
                    return sortOrder === 'desc' ? b.amount - a.amount : a.amount - b.amount;
                });
            }, [investorsForPage, sortOrder]);
            
            if (loading && !stats.total_investment) {
                return React.createElement('div', { className: 'flex items-center justify-center h-screen' },
                    React.createElement('div', { className: 'text-center p-8 card max-w-md' },
                        React.createElement('div', { className: 'inline-block w-8 h-8 border-4 border-t-transparent border-white rounded-full animate-spin mb-4' }),
                        React.createElement('p', { className: 'mb-6' }, 'Loading Session Sale Data...'),
                        React.createElement('div', { className: 'note-box' },
                            React.createElement('p', { className: 'text-sm text-gray-300' },
                                'Note: This dashboard displays only the total amount successfully invested, not the amount being requested on the Legion website.'
                            )
                        )
                    )
                );
            }
            
            if (error) {
                return React.createElement('div', { className: 'main-container' },
                    React.createElement('div', { className: 'card p-8 text-center' },
                        React.createElement('h2', { className: 'text-xl text-red-500 mb-4' }, 'Error'),
                        React.createElement('p', null, error),
                        React.createElement('button', {
                            onClick: fetchData,
                            className: 'pagination-button mt-4'
                        }, 'Retry')
                    )
                );
            }
            
            return React.createElement('div', { className: 'main-container' },
                // Back to Dashboard Button
                React.createElement('a', { href: '/', className: 'back-button' },
                    React.createElement('svg', {
                        xmlns: 'http://www.w3.org/2000/svg',
                        width: '16',
                        height: '16',
                        viewBox: '0 0 24 24',
                        fill: 'none',
                        stroke: 'currentColor',
                        strokeWidth: '2',
                        strokeLinecap: 'round',
                        strokeLinejoin: 'round',
                        className: 'mr-2'
                    }, React.createElement('path', { d: 'M19 12H5M12 19l-7-7 7-7' })),
                    'Back to Dashboard'
                ),
                
                // Header
                React.createElement('div', { className: 'header-card' },
                    React.createElement('div', { className: 'header-title' }, 'Session'),
                    React.createElement('img', { src: '/static/session.png', alt: 'Session Logo', className: 'h-16' })
                ),
                
                // Note about data
                React.createElement('div', { className: 'note-box mb-6' },
                    React.createElement('p', { className: 'text-sm' },
                        React.createElement('span', { className: 'font-bold neon-color' }, 'Note:'),
                        ' This dashboard shows only the total amount successfully invested, not the amount being requested on the Legion website.'
                    )
                ),
                
                // Main Content Grid
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
                    // Left Column - Stats and Live Feed
                    React.createElement('div', { className: 'md:col-span-1' },
                        // Total USDC Card
                        React.createElement('div', { className: 'card p-6 text-center' },
                            React.createElement('div', { className: 'card-title' }, 'Total USDC Invested'),
                            React.createElement('div', { className: 'amount-display' }, formatCurrency(stats.total_investment || 0)),
                            React.createElement('div', { className: 'text-gray-400 text-sm' }, stats.total_investors + ' unique addresses')
                        ),
                        
                        // Live Feed Component
                        React.createElement(LiveFeed, null),
                        
                        // Stats section
                        React.createElement('div', { className: 'stats-section' },
                            React.createElement('div', { className: 'stats-title' }, 'Investment Stats'),
                            
                            React.createElement('div', { className: 'stats-card' },
                                React.createElement('div', { className: 'stats-label' }, 'Average'),
                                React.createElement('div', { className: 'stats-value' }, formatCurrency(stats.average_allocation || 0))
                            ),
                            
                            React.createElement('div', { className: 'stats-card' },
                                React.createElement('div', { className: 'stats-label' }, 'Median'),
                                React.createElement('div', { className: 'stats-value' }, formatCurrency(stats.median_investment || 0))
                            ),
                            
                            React.createElement('div', { className: 'stats-card' },
                                React.createElement('div', { className: 'stats-label' }, 'Largest'),
                                React.createElement('div', { className: 'stats-value' }, formatCurrency(stats.highest_allocation || 0))
                            ),
                            
                            React.createElement('div', { className: 'stats-card' },
                                React.createElement('div', { className: 'stats-label' }, 'Smallest'),
                                React.createElement('div', { className: 'stats-value' }, formatCurrency(stats.lowest_allocation || 0))
                            )
                        )
                    ),
                    
                    // Right Column - Investors Table
                    React.createElement('div', { className: 'md:col-span-2' },
                        React.createElement('div', { className: 'card' },
                            React.createElement('div', { className: 'p-4 border-b border-gray-800' },
                                React.createElement('div', { className: 'card-title' }, 'Top Investors'),
                                React.createElement('div', { className: 'card-subtitle' }, 'Ranked by investment amount')
                            ),
                            
                            React.createElement('div', { className: 'table-container' },
                                React.createElement('table', { className: 'data-table' },
                                    React.createElement('thead', null,
                                        React.createElement('tr', { className: 'table-header' },
                                            React.createElement('th', null, 'Rank'),
                                            React.createElement('th', null, 'Address'),
                                            React.createElement('th', { className: 'cursor-pointer', onClick: toggleSortOrder },
                                                'Amount ' + (sortOrder === 'desc' ? '↓' : '↑')
                                            ),
                                            React.createElement('th', { className: 'text-right' }, '% of Total')
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        sortedInvestors.map(function(investor, index) {
                                            return React.createElement('tr', { key: investor.address, className: 'table-row' },
                                                React.createElement('td', null,
                                                    (currentPage - 1) * investorsPerPage + index + 1 <= 3 ?
                                                        React.createElement('span', { className: 'rank-badge' },
                                                            (currentPage - 1) * investorsPerPage + index + 1
                                                        ) :
                                                        React.createElement('span', null, '#' + ((currentPage - 1) * investorsPerPage + index + 1))
                                                ),
                                                React.createElement('td', { className: 'address-cell' },
                                                    React.createElement('a', {
                                                        href: '#',
                                                        onClick: function(e) {
                                                            e.preventDefault();
                                                            handleInvestorClick(investor.address);
                                                        },
                                                        title: investor.address
                                                    }, formatAddress(investor.address))
                                                ),
                                                React.createElement('td', { className: 'text-right font-mono' },
                                                    formatCurrency(investor.amount)
                                                ),
                                                React.createElement('td', { className: 'text-right' },
                                                    stats.total_investment ? ((investor.amount / stats.total_investment) * 100).toFixed(2) : '0.00' + '%'
                                                )
                                            );
                                        }),
                                        sortedInvestors.length === 0 &&
                                            React.createElement('tr', { className: 'table-row' },
                                                React.createElement('td', { colSpan: '4', className: 'text-center py-4' },
                                                    'No investors data available yet'
                                                )
                                            )
                                    )
                                ),
                                
                                // Pagination
                                totalPages > 1 &&
                                    React.createElement('div', { className: 'pagination' },
                                        React.createElement('button', {
                                            className: 'pagination-button',
                                            onClick: function() { handlePageChange(Math.max(1, currentPage - 1)); },
                                            disabled: currentPage === 1
                                        }, 'Previous'),
                                        
                                        React.createElement('div', { className: 'pagination-info' },
                                            currentPage + ' of ' + totalPages
                                        ),
                                        
                                        React.createElement('button', {
                                            className: 'pagination-button',
                                            onClick: function() { handlePageChange(Math.min(totalPages, currentPage + 1)); },
                                            disabled: currentPage === totalPages
                                        }, 'Next')
                                    )
                            )
                        )
                    )
                ),
                
                React.createElement('div', { className: 'text-center text-gray-500 text-sm mt-6' },
                    'Last updated: ' + new Date().toLocaleString()
                ),
                
                // Investor Modal
                showModal &&
                    React.createElement('div', { className: 'investor-modal' },
                        React.createElement('div', { className: 'investor-modal-content' },
                            React.createElement('span', { className: 'investor-modal-close', onClick: closeModal }, '×'),
                            React.createElement('div', { className: 'investor-details' },
                                React.createElement('h2', null, 'Investor Details'),
                                investorLoading &&
                                    React.createElement('div', { className: 'flex items-center justify-center py-8' },
                                        React.createElement('div', { className: 'loading-spinner' })
                                    ),
                                !investorLoading && selectedInvestor &&
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'mb-4' },
                                            React.createElement('div', { className: 'text-gray-400 text-sm mb-1' }, 'Full Address'),
                                            React.createElement('div', { className: 'font-mono text-sm break-all' }, selectedInvestor.address)
                                        ),
                                        React.createElement('div', { className: 'investor-stats' },
                                            React.createElement('div', { className: 'investor-stat' },
                                                React.createElement('div', { className: 'investor-stat-value' }, formatCurrency(selectedInvestor.session_total)),
                                                React.createElement('div', { className: 'investor-stat-label' }, 'Session Investment')
                                            ),
                                            React.createElement('div', { className: 'investor-stat' },
                                                React.createElement('div', { className: 'investor-stat-value' }, formatCurrency(selectedInvestor.total_invested)),
                                                React.createElement('div', { className: 'investor-stat-label' }, 'Total Invested (All Sales)')
                                            )
                                        ),
                                        
                                        React.createElement('div', { className: 'mt-6' },
                                            React.createElement('h3', { className: 'font-bold text-lg mb-3' }, 'All Sales'),
                                            React.createElement('div', { className: 'sales-table-container' },
                                                React.createElement('table', { className: 'data-table' },
                                                    React.createElement('thead', null,
                                                        React.createElement('tr', { className: 'table-header' },
                                                            React.createElement('th', null, 'Sale'),
                                                            React.createElement('th', null, 'Amount')
                                                        )
                                                    ),
                                                    React.createElement('tbody', null,
                                                        selectedInvestor.sales && selectedInvestor.sales.length > 0 ?
                                                            selectedInvestor.sales.map(function(sale, index) {
                                                                return React.createElement('tr', {
                                                                    key: index,
                                                                    className: 'table-row ' + (sale.sale && sale.sale.toLowerCase() === 'session' ? 'session-sale' : '')
                                                                },
                                                                    React.createElement('td', null,
                                                                        React.createElement('span', {
                                                                            className: 'sale-badge ' + (sale.sale && sale.sale.toLowerCase() === 'session' ? 'session' : 'other')
                                                                        },
                                                                            (sale.sale && sale.sale.toLowerCase() === 'session' ? '★ ' : '') + (sale.sale ? sale.sale.toUpperCase() : 'UNKNOWN')
                                                                        )
                                                                    ),
                                                                    React.createElement('td', null, formatCurrency(sale.amount || 0))
                                                                );
                                                            }) :
                                                            React.createElement('tr', { className: 'table-row' },
                                                                React.createElement('td', { colSpan: '2', className: 'text-center py-4' },
                                                                    'No sales data available'
                                                                )
                                                            )
                                                    )
                                                )
                                            )
                                        )
                                    ),
                                !investorLoading && !selectedInvestor &&
                                    React.createElement('div', { className: 'text-red-500 text-center py-4' },
                                        'Failed to load investor details'
                                    )
                            )
                        )
                    )
            );
        }
        
        // Render the app
        ReactDOM.render(React.createElement(SessionTracker, null), document.getElementById('app'));
    </script>
</body>
</html>
